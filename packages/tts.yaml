script:
  tts_speak:
    alias: "Wrapper for TTS service"
    sequence:
      - service: tts.speak
        data:
          cache: "{{ cache or 'false' }}"
          media_player_entity_id: "{{ media_player_entity_id }}"
          message: "{{ message | replace('\n', ' ') }}"
        target:
          entity_id: tts.piper
      # - service: tts.cloud_say
      #   data:
      #     cache: "{{ cache }}"
      #     entity_id: "{{ media_player_entity_id }}"
      #     message: "{{ message | replace('\n', ' ') }}"
      #     language: da-DK
      #     options:
      #       gender: male

command_line:
  - sensor:
      name: Latest TTS
      command: "ls -t /config/tts | head -n 1"
  - sensor:
      name: Latest TTS FFMPEG Info
      command: "/usr/bin/ffmpeg -i /config/tts/{{ states('sensor.latest_tts') }} 2>&1 | grep Duration"

sensor:
  - platform: template
    sensors:
      latest_tts_duration:
        value_template: >-
          {{ states('sensor.latest_tts_ffmpeg_info').split(', ')[0].split(': ')[1].split('.')[0] }}
      tts_greeting:
        value_template: >-
          {%- if now().hour < 4 -%}
            Godnat
          {%- elif now().hour < 10 -%}
            Godmorgen
          {%- elif now().hour < 14 -%}
            Goddag
          {%- elif now().hour < 17 -%}
            God eftermiddag
          {%- elif now().hour < 24 -%}
            Godaften
          {%- endif -%}
