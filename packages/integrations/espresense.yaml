sensor:
  # One entry for each beacon you want to track
  - platform: mqtt_room
    device_id: !secret darkphone_btle_uuid
    name: "DarkPhone Room"
    state_topic: !secret darkphone_btle_espresense_topic
    timeout: 10
    away_timeout: 120

automation:
  - alias: espresense notification
    trigger:
      - platform: state
        entity_id: sensor.darkphone_room
        from: "not_home"
    action:
      - service: script.debug_notification
        data_template:
          message: "Espresense: {{ states('sensor.darkphone_room') }}"
          title: "Espresense"
      - service: notify.telegram_darkfox
        data:
          message: "Espresense: {{ states('sensor.darkphone_room') }}"

  - alias: Turn off BLE transmitter
    trigger:
      - platform: state
        entity_id: binary_sensor.darkphone_beacon_used
        to: "off"
    action:
      - service: notify.mobile_app_darkphone
        data:
          message: "command_ble_transmitter"
          data:
            command: "turn_off"

  - alias: Turn on BLE transmitter
    trigger:
      - platform: state
        entity_id: binary_sensor.darkphone_beacon_used
        to: "on"
    action:
      - service: notify.mobile_app_darkphone
        data:
          message: "command_ble_transmitter"
          data:
            command: "turn_on"
