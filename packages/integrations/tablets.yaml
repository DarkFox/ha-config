script:
  reload_lovelace_on_tablets:
    alias: "Reload lovelace on all tablets"
    sequence:
      - service: light.turn_on
        target:
          entity_id:
            - light.kitchen_tablet
            - light.hallway_tablet
            - light.bathroom_tablet
            - light.office_tablet
            - light.bedroom_tablet
      - delay:
          seconds: 5
      - service: browser_mod.javascript
        data:
          code: "lovelace_reload();"
      - delay:
          seconds: 10
      - service: browser_mod.refresh
      - delay:
          seconds: 20
      - event: refresh_light_profile

automation:
  - alias: charge_kitchen_tablet
    trigger:
      - platform: numeric_state
        entity_id: sensor.kitchen_tablet_batteriniveau
        below: 60
      - platform: state
        entity_id: binary_sensor.kitchen_activity
        to: "on"
    action:
      - service: switch.turn_on
        data:
          entity_id: switch.kitchen_tablet_charger
  - alias: discharge_kitchen_tablet
    trigger:
      - platform: numeric_state
        entity_id: sensor.kitchen_tablet_batteriniveau
        above: 80
      - platform: state
        entity_id: binary_sensor.kitchen_activity
        to: "off"
    condition:
      - condition: numeric_state
        entity_id: sensor.kitchen_tablet_batteriniveau
        above: 80
      - condition: state
        entity_id: binary_sensor.kitchen_activity
        state: "off"
    action:
      - service: switch.turn_off
        data:
          entity_id: switch.kitchen_tablet_charger

  - alias: charge_hallway_tablet
    trigger:
      - platform: numeric_state
        entity_id: sensor.hallway_tablet_batteriniveau
        below: 60
      - platform: state
        entity_id: binary_sensor.hallway_activity
        to: "on"
    action:
      - service: switch.turn_on
        data:
          entity_id: switch.hallway_tablet_charger
  - alias: discharge_hallway_tablet
    trigger:
      - platform: numeric_state
        entity_id: sensor.hallway_tablet_batteriniveau
        above: 80
      - platform: state
        entity_id: binary_sensor.hallway_activity
        to: "off"
    condition:
      - condition: numeric_state
        entity_id: sensor.hallway_tablet_batteriniveau
        above: 80
      - condition: state
        entity_id: binary_sensor.hallway_activity
        state: "off"
    action:
      - service: switch.turn_off
        data:
          entity_id: switch.hallway_tablet_charger

  - alias: bathroom_tablet_ip_webhook
    initial_state: True
    trigger:
      platform: webhook
      webhook_id: !secret bathroom_tablet_ip_webhook
    action:
      service: "input_text.set_value"
      data:
        entity_id: input_text.bathroom_tablet_ip
        value: "{{ trigger.json.state }}"

  - alias: office_tablet_ip_webhook
    initial_state: True
    trigger:
      platform: webhook
      webhook_id: !secret office_tablet_ip_webhook
    action:
      service: "input_text.set_value"
      data:
        entity_id: input_text.office_tablet_ip
        value: "{{ trigger.json.state }}"

  - alias: bedroom_tablet_screensaver_webhook
    initial_state: True
    trigger:
      platform: webhook
      webhook_id: !secret bedroom_tablet_screensaver_webhook
    action:
      service: "input_boolean.turn_{{ trigger.json.state }}"
      data:
        entity_id: input_boolean.bedroom_tablet_screensaver

  - alias: charge_bedroom_tablet
    trigger:
      - platform: numeric_state
        entity_id: sensor.sovevaerelse_tablet_batteriniveau
        below: 60
      - platform: state
        entity_id: binary_sensor.bedroom_activity
        to: "on"
    action:
      - service: switch.turn_on
        data:
          entity_id: switch.bedroom_tablet_charger

  - alias: discharge_bedroom_tablet
    trigger:
      - platform: numeric_state
        entity_id: sensor.sovevaerelse_tablet_batteriniveau
        above: 80
      - platform: state
        entity_id: binary_sensor.bedroom_activity
        to: "off"
    condition:
      - condition: numeric_state
        entity_id: sensor.sovevaerelse_tablet_batteriniveau
        above: 80
      - condition: state
        entity_id: binary_sensor.bedroom_activity
        state: "off"
    action:
      - service: switch.turn_off
        data:
          entity_id: switch.bedroom_tablet_charger

input_text:
  bathroom_tablet_ip:
    name: Bathroom Tablet IP
  office_tablet_ip:
    name: Office Tablet IP

rest_command:
  kitchen_tablet_command:
    url: "http://{{ states('sensor.kokken_tablet_wifi_ip_address') }}:1817/?message={{ command }}"
    method: GET
  hallway_tablet_command:
    url: "http://{{ states('sensor.gang_tablet_wifi_ip_address') }}:1817/?message={{ command }}"
    method: GET
  bathroom_tablet_command:
    url: "http://{{ states('input_text.bathroom_tablet_ip') }}:1817/?message={{ command }}"
    method: GET
  office_tablet_command:
    url: "http://{{ states('input_text.office_tablet_ip') }}:1817/?message={{ command }}"
    method: GET
  bedroom_tablet_command:
    url: "http://{{ states('sensor.sovevaerelse_tablet_wifi_ip_address') }}:1817/?message={{ command }}"
    method: GET

light:
  - platform: template
    lights:
      kitchen_tablet:
        friendly_name: "kitchen Tablet"
        level_template: "{{ states('sensor.kokken_tablet_screen_brightness')|int }}"
        value_template: "{{ states('binary_sensor.kokken_tablet_interactive') }}"
        turn_on:
          - service: notify.mobile_app_kokken_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
        turn_off:
          - service: rest_command.kitchen_tablet_command
            data:
              command: "screen=:=off"
        set_level:
          - service: notify.mobile_app_kokken_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
          - service: notify.mobile_app_kokken_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"
          - delay:
              seconds: 1
          - service: notify.mobile_app_kokken_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"

      hallway_tablet:
        friendly_name: "Hallway Tablet"
        level_template: "{{ states('sensor.gang_tablet_screen_brightness')|int }}"
        value_template: "{{ states('binary_sensor.gang_tablet_interactive') }}"
        turn_on:
          - service: notify.mobile_app_gang_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
        turn_off:
          - service: rest_command.hallway_tablet_command
            data:
              command: "screen=:=off"
        set_level:
          - service: notify.mobile_app_gang_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
          - service: notify.mobile_app_gang_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"
          - delay:
              seconds: 1
          - service: notify.mobile_app_gang_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"

      bathroom_tablet:
        friendly_name: "Bathroom Tablet"
        level_template: "{{ states('sensor.badevaerelse_tablet_screen_brightness')|int }}"
        value_template: "{{ states('binary_sensor.badevaerelse_tablet_interactive') }}"
        turn_on:
          - service: notify.mobile_app_badevaerelse_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
        turn_off:
          - service: rest_command.bathroom_tablet_command
            data:
              command: "screen=:=off"
        set_level:
          - service: notify.mobile_app_badevaerelse_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
          - service: notify.mobile_app_badevaerelse_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"
          - delay:
              seconds: 1
          - service: notify.mobile_app_badevaerelse_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"

      office_tablet:
        friendly_name: "Office Tablet"
        level_template: "{{ states('sensor.kontor_tablet_screen_brightness')|int }}"
        value_template: "{{ states('binary_sensor.kontor_tablet_interactive') }}"
        turn_on:
          - service: notify.mobile_app_kontor_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
        turn_off:
          - service: rest_command.office_tablet_command
            data:
              command: "screen=:=off"
        set_level:
          - service: notify.mobile_app_kontor_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
          - service: notify.mobile_app_kontor_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"
          - delay:
              seconds: 1
          - service: notify.mobile_app_kontor_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"

      bedroom_tablet:
        friendly_name: "Bedroom Tablet"
        level_template: "{{ states('sensor.sovevaerelse_tablet_screen_brightness')|int }}"
        value_template: "{{ states('binary_sensor.sovevaerelse_tablet_interactive') }}"
        turn_on:
          - service: notify.mobile_app_sovevaerelse_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
        turn_off:
          - service: rest_command.bedroom_tablet_command
            data:
              command: "screen=:=off"
        set_level:
          - service: notify.mobile_app_sovevaerelse_tablet
            data:
              message: "command_screen_on"
              data:
                command: "keep_screen_on"
          - service: notify.mobile_app_sovevaerelse_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"
          - delay:
              seconds: 1
          - service: notify.mobile_app_sovevaerelse_tablet
            data:
              message: "command_screen_brightness_level"
              data:
                command: "{{ brightness }}"

      bedroom_tablet_screensaver:
        friendly_name: "Bedroom Tablet Screensaver"
        value_template: "{{ states('input_boolean.bedroom_tablet_screensaver') }}"
        turn_on:
          - service: rest_command.bedroom_tablet_command
            data:
              command: "screensaver=:=on"
        turn_off:
          - service: rest_command.bedroom_tablet_command
            data:
              command: "screensaver=:=off"
