homeassistant:
  customize:
    sensor.energy_hourly:
      friendly_name: Elforbrug Denne Time
    sensor.energy_daily:
      friendly_name: Elforbrug I Dag
    sensor.energy_monthly:
      friendly_name: Elforbrug Denne Måned
    sensor.energy_quarterly:
      friendly_name: Elforbrug Dette Kvartal
    sensor.energy_last_hour:
      icon: mdi:counter
    sensor.energy_last_day:
      icon: mdi:counter
    sensor.energy_last_month:
      icon: mdi:counter
    sensor.energy_last_quarter:
      icon: mdi:counter
    sensor.energy_cost_this_hour:
      icon: mdi:cash-multiple
    sensor.energy_cost_daily:
      icon: mdi:cash-multiple
    sensor.energy_cost_monthly:
      icon: mdi:cash-multiple
    sensor.energy_cost_quarterly:
      icon: mdi:cash-multiple
    sensor.energy_cost_last_hour:
      icon: mdi:cash-multiple
    sensor.energy_cost_last_day:
      icon: mdi:cash-multiple
    sensor.energy_cost_last_month:
      icon: mdi:cash-multiple
    sensor.energy_cost_last_quarter:
      icon: mdi:cash-multiple

utility_meter:
  energy_hourly:
    source: sensor.pow_k_tpi
    cycle: hourly
  energy_daily:
    source: sensor.pow_k_tpi
    cycle: daily
  energy_monthly:
    source: sensor.pow_k_tpi
    cycle: monthly
  energy_quarterly:
    source: sensor.pow_k_tpi
    cycle: quarterly

input_number:
  energy_cost:
    name: Energy Cost
    mode: box
    min: 0
    max: 100000
    step: 0.001
    unit_of_measurement: kr

automation:
  - alias: Update Energy Cost
    initial_state: true
    trigger:
      - platform: state
        entity_id: sensor.energy_cost_this_hour
        to: "0.000"
    action:
      - service: input_number.set_value
        data:
          entity_id: input_number.energy_cost
          value: "{{ (state('input_number.energy_cost')|float) + (trigger.from_state.state|float) }}"

sensor:
  - platform: template
    sensors:
      energy_cost_hourly:
        friendly_name: "Elomkostning"
        value_template: "{{ (((states('sensor.pow_k_p')|float)/1000) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(3) }}"
        unit_of_measurement: kr/t
        attribute_templates:
          icon: mdi:cash

      energy_cost_this_hour:
        friendly_name: "Elomkostning Denne Time"
        value_template: "{{ ((states('sensor.energy_hourly')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(3) }}"
        unit_of_measurement: kr

      energy_last_hour:
        friendly_name: "Elforbrug Sidste Time"
        value_template: "{{ state_attr('sensor.energy_hourly', 'last_period') }}"
        unit_of_measurement: kWh
      energy_last_day:
        friendly_name: "Elforbrug I Går"
        value_template: "{{ state_attr('sensor.energy_daily', 'last_period') }}"
        unit_of_measurement: kWh
      energy_last_month:
        friendly_name: "Elforbrug Sidste Måned"
        value_template: "{{ state_attr('sensor.energy_monthly', 'last_period') }}"
        unit_of_measurement: kWh
      energy_last_quarter:
        friendly_name: "Elforbrug Sidste Kvartal"
        value_template: "{{ state_attr('sensor.energy_quarterly', 'last_period') }}"
        unit_of_measurement: kWh

      # energy_cost_daily:
      #   friendly_name: "Elomkostning I Dag"
      #   value_template: "{{ ((states('sensor.energy_daily')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(2) }}"
      #   unit_of_measurement: kr
      # energy_cost_monthly:
      #   friendly_name: "Elomkostning Denne Måned"
      #   value_template: "{{ ((states('sensor.energy_monthly')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(2) }}"
      #   unit_of_measurement: kr
      # energy_cost_quarterly:
      #   friendly_name: "Elomkostning Dette Kvartal"
      #   value_template: "{{ ((states('sensor.energy_quarterly')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(2) }}"
      #   unit_of_measurement: kr
      # energy_cost_last_hour:
      #   friendly_name: "Elomkostning Sidste Time"
      #   value_template: "{{ ((states('sensor.energy_last_hour')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(2) }}"
      #   unit_of_measurement: kr
      # energy_cost_last_day:
      #   friendly_name: "Elomkostning I Går"
      #   value_template: "{{ ((states('sensor.energy_last_day')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(2) }}"
      #   unit_of_measurement: kr
      # energy_cost_last_month:
      #   friendly_name: "Elomkostning Sidste Måned"
      #   value_template: "{{ ((states('sensor.energy_last_month')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(2) }}"
      #   unit_of_measurement: kr
      # energy_cost_last_quarter:
      #   friendly_name: "Elomkostning Sidste Kvartal"
      #   value_template: "{{ ((states('sensor.energy_last_quarter')|float) * (states('sensor.nordpool_kwh_dk2_dkk')|float)) | round(2) }}"
      #   unit_of_measurement: kr
