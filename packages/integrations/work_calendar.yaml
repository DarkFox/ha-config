template:
  - binary_sensor:
      - name: Arbejdskalender På RSR
        unique_id: arbejdskalender_pa_rsr
        state: >-
          {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'På RSR') | map(attribute='entity_id') | list)[0] -%}
          {{ entity_id and state_attr(entity_id, 'start') < now() and state_attr(entity_id, 'end') > now() }}
        attributes:
          start_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'På RSR') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'start') }}
            {%- endif -%}
          end_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'På RSR') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'end') }}
            {%- endif -%}
          icon: mdi:calendar

      - name: Arbejdskalender På RSH
        unique_id: arbejdskalender_pa_rsh
        state: >-
          {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'På RSH') | map(attribute='entity_id') | list)[0] -%}
          {{ entity_id and state_attr(entity_id, 'start') < now() and state_attr(entity_id, 'end') > now() }}
        attributes:
          start_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'På RSH') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'start') }}
            {%- endif -%}
          end_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'På RSH') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'end') }}
            {%- endif -%}
          icon: mdi:calendar

      - name: Arbejdskalender Vagt
        unique_id: arbejdskalender_vagt
        state: >-
          {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Vagt') | map(attribute='entity_id') | list)[0] -%}
          {{ entity_id and state_attr(entity_id, 'start') < now() and state_attr(entity_id, 'end') > now() }}
        attributes:
          start_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Vagt') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'start') }}
            {%- endif -%}
          end_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Vagt') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'end') }}
            {%- endif -%}
          icon: mdi:calendar

      - name: Arbejdskalender Arbejder Hjemmefra
        unique_id: arbejdskalender_arbejder_hjemmefra
        state: >-
          {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Arbejder Hjemmefra') | map(attribute='entity_id') | list)[0] -%}
          {{ entity_id and state_attr(entity_id, 'start') < now() and state_attr(entity_id, 'end') > now() }}
        attributes:
          start_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Arbejder Hjemmefra') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'start') }}
            {%- endif -%}
          end_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Arbejder Hjemmefra') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'end') }}
            {%- endif -%}
          icon: mdi:calendar

      - name: Arbejdskalender Fri
        unique_id: arbejdskalender_fri
        state: >-
          {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Fri') | map(attribute='entity_id') | list)[0] -%}
          {{ entity_id and state_attr(entity_id, 'start') < now() and state_attr(entity_id, 'end') > now() }}
        attributes:
          start_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Fri') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'start') }}
            {%- endif -%}
          end_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Fri') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'end') }}
            {%- endif -%}
          icon: mdi:calendar

      - name: Arbejdskalender Ferie
        unique_id: arbejdskalender_ferie
        state: >-
          {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Ferie') | map(attribute='entity_id') | list)[0] -%}
          {{ entity_id and state_attr(entity_id, 'start') < now() and state_attr(entity_id, 'end') > now() }}
        attributes:
          start_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Ferie') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'start') }}
            {%- endif -%}
          end_time: >-
            {%- set entity_id = (states.sensor | selectattr('entity_id', 'search', 'ical_arbejde_event_') | selectattr('state', 'search', 'Ferie') | map(attribute='entity_id') | list)[0] -%}
            {%- if entity_id -%}
              {{ state_attr(entity_id, 'end') }}
            {%- endif -%}
          icon: mdi:calendar
