google_assistant:
  project_id: !secret google_assistant_project_id
  client_id: !secret google_assistant_client_id
  access_token: !secret google_assistant_access_token
  agent_user_id: !secret google_assistant_agent_user_id
  api_key: !secret google_assistant_api_key
  exposed_domains:
    - switch
    - light
    - cover
    - fan
    - scene
    - climate
    - group

automation:
  - alias: alexa_timer
    trigger:
      platform: state
      entity_id: sensor.alexa_timer
    action:
      service: script.turn_on
      entity_id: script.alexa_timer

  - alias: alexa_alarm
    trigger:
      platform: state
      entity_id: sensor.alexa_alarm
    action:
      service: script.turn_on
      entity_id: script.alexa_alarm

script:
  alexa_timer:
    sequence:
      - service: mqtt.publish
        data:
          topic: "milight/0x4242/rgb_cct/1"
          payload: "{'status': 'on', 'mode': 7}"
      - service: mqtt.publish
        data:
          topic: "milight/0x4243/rgb_cct/2"
          payload: "{'status': 'on', 'mode': 7}"
      - service: mqtt.publish
        data:
          topic: "milight/0x7E92/rgbw/3"
          payload: "{'status': 'on', 'mode': 6}"
      - delay:
          seconds: 20
      - service: mqtt.publish
        data:
          topic: "milight/0x4242/rgb_cct/1"
          payload: "{'status': 'off'}"
      - service: mqtt.publish
        data:
          topic: "milight/0x4242/rgb_cct/1"
          payload: "{'status': 'off'}"
      - service: mqtt.publish
        data:
          topic: "milight/0x4243/rgb_cct/2"
          payload: "{'status': 'off'}"

  alexa_alarm:
    sequence:
      - service: mqtt.publish
        data:
          topic: "milight/0x4242/rgb_cct/1"
          payload: "{'status': 'on', 'mode': 6}"
      - service: mqtt.publish
        data:
          topic: "milight/0x4243/rgb_cct/2"
          payload: "{'status': 'on', 'mode': 6}"
      - service: mqtt.publish
        data:
          topic: "milight/0x7E92/rgbw/3"
          payload: "{'status': 'on', 'mode': 5}"
      - delay:
          seconds: 60
      - service: mqtt.publish
        data:
          topic: "milight/0x4242/rgb_cct/1"
          payload: "{'status': 'off'}"
      - service: mqtt.publish
        data:
          topic: "milight/0x4242/rgb_cct/1"
          payload: "{'status': 'off'}"
      - service: mqtt.publish
        data:
          topic: "milight/0x4243/rgb_cct/2"
          payload: "{'status': 'off'}"

intent_script:
  DimLightsIntent:
    action:
      service: input_select.select_next
      entity_id: input_select.light_profile
    speech:
      text: >
        Dimming the lights.

  BrightenLightsIntent:
    action:
      service: input_select.select_previous
      entity_id: input_select.light_profile
    speech:
      text: >
        Brightening the lights.

  WorkTravelTime:
    speech:
      text: >
        Current travel time to work is {{ states("sensor.travel_time_to_work") }} minutes.

  WeatherReport:
    speech:
      text: >
        The weather is {{ states("sensor.pws_weather") }} with a high of {{ states("sensor.pws_temp_high_1d_c") }} degrees
        and a low of {{ states("sensor.pws_temp_low_1d_c") }}. There is a {{ states("sensor.pws_precip_1d") }}% chance of rain.

  PlayLastTwitchStreamIntent:
    action:
      service: media_extractor.play_media
      data_template:
        entity_id: "media_player.{{ Device | lower | replace(' ', '_') }}"
        media_content_id: "{{ states('sensor.twitch_stream') }}"
        media_content_type: TVSHOW
    speech:
      type: plaintext
      text: >
        Sending {{ states.sensor.twitch_stream.attributes.stream_name }} to {{ Device }}

# Hide groups and devices from haaska
homeassistant:
  customize_glob:
    "group.light_profile_*":
      haaska_hidden: true
      google_assistant: false
    "group.motion_triggers_*":
      haaska_hidden: true
      google_assistant: false

    "switch.livingroom_remote_*":
      haaska_hidden: true
      google_assistant: false
    "switch.bedroom_remote_*":
      haaska_hidden: true
      google_assistant: false

    "switch.tv_remote_*":
      haaska_hidden: true
      google_assistant: false
    "switch.tv_soundbar_*":
      haaska_hidden: true
      google_assistant: false

    "switch.hdmi_matrix_*":
      haaska_hidden: true
      google_assistant: false
    "switch.projector_soundbar_*":
      haaska_hidden: true
      google_assistant: false
    "switch.projector_*":
      haaska_hidden: true
      google_assistant: false
    "switch.hdmi_switch_*":
      haaska_hidden: true
      google_assistant: false
    "switch.fan_remote_*":
      haaska_hidden: true
      google_assistant: false

    "script.*":
      haaska_hidden: true
      google_assistant: false
    "automation.*":
      haaska_hidden: true
      google_assistant: false

  customize:
    # Renames
    scene.ambient:
      google_assistant_name: Ambient Scene
    scene.bright:
      google_assistant_name: Bright Scene
    scene.default:
      google_assistant_name: Default Scene
    scene.dimmed:
      google_assistant_name: Dimmed Scene
    scene.night:
      google_assistant_name: Night Scene
    # Stuff to hide
    scene.false:
      haaska_hidden: true
      google_assistant: false

    group.energy_meter:
      haaska_hidden: true
      google_assistant: false
    group.date_time:
      haaska_hidden: true
      google_assistant: false
    group.travel_time:
      haaska_hidden: true
      google_assistant: false
    group.weather_view:
      haaska_hidden: true
      google_assistant: false
    group.sleep_as_android:
      haaska_hidden: true
      google_assistant: false

    group.fan_remote:
      haaska_hidden: true
      google_assistant: false
    group.tv_remote:
      haaska_hidden: true
      google_assistant: false
    group.tv_soundbar_remote:
      haaska_hidden: true
      google_assistant: false
    group.projector_remote:
      haaska_hidden: true
      google_assistant: false
    group.hdmi_matrix_remote:
      haaska_hidden: true
      google_assistant: false
    group.hdmi_switch_remote:
      haaska_hidden: true
      google_assistant: false
    group.projector_soundbar_remote:
      haaska_hidden: true
      google_assistant: false

    group.livingroom_remote:
      haaska_hidden: true
      google_assistant: false
    group.bedroom_remote:
      haaska_hidden: true
      google_assistant: false

    input_boolean.iss_pass:
      haaska_hidden: true
      google_assistant: false
    switch.apartment_lock:
      haaska_hidden: true
      google_assistant: false
    switch.apartment_door:
      haaska_hidden: true
      google_assistant: false
    switch.bathroom_window:
      haaska_hidden: true
      google_assistant: false
    switch.storage_room_motion:
      haaska_hidden: true
      google_assistant: false

    group.activity:
      haaska_hidden: true
      google_assistant: false
    group.system_monitor:
      haaska_hidden: true
      google_assistant: false

    group.bedroom_media:
      haaska_hidden: true
      google_assistant: false
    group.kitchen_media:
      haaska_hidden: true
      google_assistant: false
    group.office_media:
      haaska_hidden: true
      google_assistant: false
    group.livingroom_media:
      haaska_hidden: true
      google_assistant: false
    group.internet_speed:
      haaska_hidden: true
      google_assistant: false
    group.all_automations:
      haaska_hidden: true
      google_assistant: false
    group.all_devices:
      haaska_hidden: true
      google_assistant: false
    group.all_scripts:
      haaska_hidden: true
      google_assistant: false
    group.all_switches:
      haaska_hidden: true
      google_assistant: false
    group.bathroom_group:
      haaska_hidden: true
      google_assistant: false
    group.bedroom_group:
      haaska_hidden: true
      google_assistant: false
    group.storage_room:
      haaska_hidden: true
      google_assistant: false
    group.hallway:
      haaska_hidden: true
      google_assistant: false
    group.home_assistant_automations:
      haaska_hidden: true
      google_assistant: false
    group.home_view:
      haaska_hidden: true
      google_assistant: false
    group.kitchen:
      haaska_hidden: true
      google_assistant: false
    group.livingroom:
      haaska_hidden: true
      google_assistant: false
    group.office:
      haaska_hidden: true
      google_assistant: false
    group.withings_scale:
      haaska_hidden: true
      google_assistant: false
    group.weather:
      haaska_hidden: true
      google_assistant: false
    group.daily_forecast:
      haaska_hidden: true
      google_assistant: false
    group.wunderground:
      haaska_hidden: true
      google_assistant: false
    group.livingroom_climate:
      haaska_hidden: true
      google_assistant: false
    group.relative_humidity:
      haaska_hidden: true
      google_assistant: false

    group.multisensors:
      haaska_hidden: true
      google_assistant: false
    group.hallway_sensors:
      haaska_hidden: true
      google_assistant: false
    group.livingroom_sensors:
      haaska_hidden: true
      google_assistant: false
    group.office_sensors:
      haaska_hidden: true
      google_assistant: false
    group.kitchen_sensors:
      haaska_hidden: true
      google_assistant: false
    group.bathroom_sensors:
      haaska_hidden: true
      google_assistant: false
    group.bedroom_sensors:
      haaska_hidden: true
      google_assistant: false
    group.batteries:
      haaska_hidden: true
      google_assistant: false
    group.motion_sensors:
      haaska_hidden: true
      google_assistant: false
    group.temperature_sensors:
      haaska_hidden: true
      google_assistant: false

    group.light_profile:
      haaska_hidden: true
      google_assistant: false

    # Stuff to show
    script.fix_soundbar_lag:
      haaska_hidden: false
