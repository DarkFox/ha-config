template:
  - sensor:
      - name: Elkedel Status
        state: >-
          {% set statuses = {
            '0': 'Slukket',
            '1': 'Fejl',
            '2': 'Fjernet fra base',
            '3': 'Varmer',
            '4': 'Holder varm',
            '5': 'Færdig'
          } %}
          {% set status_id = states('sensor.elkedel_status_id') %}
          {{ statuses[status_id] }}
        attributes:
          icon: >-
            {% set icons = {
              '0': 'mdi:kettle-outline',
              '1': 'mdi:kettle-alert-outline',
              '2': 'mdi:kettle-off-outline',
              '3': 'mdi:kettle-steam-outline',
              '4': 'mdi:kettle-steam',
              '5': 'mdi:kettle-alert'
            } %}
            {% set status_id = states('sensor.elkedel_status_id') %}
            {{ icons[status_id] }}
  - binary_sensor:
      - name: Elkedel Brygger
        state: >-
          {{ states('sensor.elkedel_status') == 'Varmer' }}
        attributes:
          icon: mdi:kettle-steam
          device_class: power

automation:
  # Notifications
  - id: kettle_brewing_notification
    alias: Elkedel Brygger Notifikation
    initial_state: true
    trigger:
      platform: state
      entity_id: binary_sensor.elkedel_brygger
      from: "off"
      to: "on"
    action:
      - service: notify.telegram_darkfox
        data:
          message: Elkedel brygger

  - id: kettle_done_notification
    alias: Elkedel Færdig Notifikation
    initial_state: true
    trigger:
      platform: state
      entity_id: binary_sensor.elkedel_brygger
      from: "on"
      to: "off"
    action:
      - service: script.notify_everywhere
        data:
          message: >-
            Elkedel færdig{{ ' og holder varm i ' + states('number.elkedel_varmholdningstid') + ' minutter' if states('sensor.elkedel_status') == 'Holder varm' else '' }}.
