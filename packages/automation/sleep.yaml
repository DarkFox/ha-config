automation:
  - alias: bedtime
    trigger:
      platform: state
      entity_id: sensor.phone_alarm
      to: 'bedtime'
    action:
      service: input_select.select_option
      data_template:
        option: 'Night'
        entity_id: >
          {% if is_state('input_boolean.guests', 'on') %}
            input_select.bedroom_light_profile
          {% else %}
            input_select.light_profile
          {% endif %}

  - alias: sleep_time
    trigger:
      platform: state
      entity_id: sensor.sleep_tracker
      to: 'tracking'
    action:
      service: input_select.select_option
      data_template:
        option: 'Off'
        entity_id: >
          {% if is_state('input_boolean.guests', 'on') %}
            input_select.bedroom_light_profile
          {% else %}
            input_select.light_profile
          {% endif %}

  - alias: sleep_paused
    trigger:
      platform: state
      entity_id: sensor.sleep_tracker
      to: 'paused'
    action:
      service: input_select.select_option
      data_template:
        option: 'Night'
        entity_id: >
          {% if is_state('input_boolean.guests', 'on') %}
            input_select.bedroom_light_profile
          {% else %}
            input_select.light_profile
          {% endif %}

  - alias: sleep_stopped
    trigger:
      platform: state
      entity_id: sensor.sleep_tracker
      to: 'stopped'
    action:
      service: input_select.select_option
      data_template:
        option: 'Dimmed'
        entity_id: >
          {% if is_state('input_boolean.guests', 'on') %}
            input_select.bedroom_light_profile
          {% else %}
            input_select.light_profile
          {% endif %}

  - alias: alarm_ringing
    trigger:
      platform: state
      entity_id: sensor.phone_alarm
      to: 'ringing'
    action:
      service: input_select.select_option
      data_template:
        option: 'Ambient'
        entity_id: >
          {% if is_state('input_boolean.guests', 'on') %}
            input_select.bedroom_light_profile
          {% else %}
            input_select.light_profile
          {% endif %}

  - alias: alarm_snooze
    trigger:
      platform: state
      entity_id: sensor.phone_alarm
      to: 'snooze'
    action:
      service: input_select.select_option
      data_template:
        option: 'Night'
        entity_id: >
          {% if is_state('input_boolean.guests', 'on') %}
            input_select.bedroom_light_profile
          {% else %}
            input_select.light_profile
          {% endif %}

  - alias: alarm_dismissed
    trigger:
      platform: state
      entity_id: sensor.phone_alarm
      to: 'dismissed'
    action:
      service: input_select.select_option
      data_template:
        option: 'Ambient'
        entity_id: >
          {% if is_state('input_boolean.guests', 'on') %}
            input_select.bedroom_light_profile
          {% else %}
            input_select.light_profile
          {% endif %}
