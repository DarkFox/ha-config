input_boolean:
  office_door_activity:
    initial: off
    name: Kontor Dør Aktivitet

binary_sensor:
  - platform: template
    sensors:
      office_door_activity:
        friendly_name: Kontor Dør Aktivitet
        device_class: motion
        value_template: "{{ is_state('input_boolean.office_door_activity', 'on') }}"
      office_occupied:
        friendly_name: Kontor Optaget
        device_class: occupancy
        value_template: "{{ is_state('input_boolean.office_occupied', 'on') }}"

automation:
  - id: office_blinds_open_at_sunup
    alias: office_blinds_open_at_sunup
    trigger:
      - platform: state
        entity_id: sun.sun
        to: above_horizon
      - platform: state
        entity_id: binary_sensor.martin_presence
        to: "on"
    condition:
      - condition: state
        entity_id: sun.sun
        state: above_horizon
      - condition: state
        entity_id: binary_sensor.martin_presence
        state: "on"
    action:
      - service: cover.open_cover
        entity_id: cover.kontor_rullegardin

  - id: office_blinds_close_at_sundown
    alias: office_blinds_close_at_sundown
    trigger:
      - platform: state
        entity_id: sun.sun
        to: below_horizon
    action:
      - service: cover.close_cover
        entity_id: cover.kontor_rullegardin

  - id: office_balcony_door_open_reminder
    alias: office_balcony_door_open_reminder
    trigger:
      - platform: state
        entity_id: sensor.office_activity_state
        to: "off"
        for:
          minutes: 15
    condition:
      - alias: "Balcony door open"
        condition: state
        entity_id: binary_sensor.kontor_altandor
        state: "on"
      - alias: "Outside temp below 18"
        condition: numeric_state
        entity_id: sensor.altan_temperatur
        below: 18
    action:
      - service: script.notify_everywhere
        data:
          message: Kontor altandør står åben!
#   - alias: office_door_activity_on
#     initial_state: true
#     trigger:
#       - platform: state
#         entity_id: binary_sensor.kontor_dor
#         to: "on"
#     action:
#       - service: input_boolean.turn_on
#         data:
#           entity_id: input_boolean.office_door_activity

#   - alias: office_door_activity_off
#     initial_state: true
#     trigger:
#       - platform: state
#         entity_id: input_boolean.office_door_activity
#         to: "on"
#         for:
#           seconds: 5
#     action:
#       - service: input_boolean.turn_off
#         data:
#           entity_id: input_boolean.office_door_activity
