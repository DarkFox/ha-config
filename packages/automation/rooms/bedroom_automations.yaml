input_boolean:
  bedroom_door_activity:
    initial: off
    name: Soveværelse Dør Aktivitet

switch:
  - platform: template
    switches:
      bedroom_curtain_automations:
        friendly_name: Soveværelse Gardiner Automatisering
        icon_template: mdi:curtains
        value_template: "{{ is_state('automation.bedroom_curtains_close_at_sundown', 'on') }}"
        turn_on:
          service: automation.turn_on
          target:
            entity_id:
              - automation.bedroom_curtains_close_at_sundown
        turn_off:
          service: automation.turn_off
          target:
            entity_id:
              - automation.bedroom_curtains_close_at_sundown

binary_sensor:
  - platform: template
    sensors:
      bedroom_door_activity:
        friendly_name: Soveværelse Dør Aktivitet
        device_class: motion
        value_template: "{{ is_state('input_boolean.bedroom_door_activity', 'on') }}"
      bedroom_occupied:
        friendly_name: Soveværelse Optaget
        device_class: occupancy
        value_template: "{{ is_state('input_boolean.bedroom_occupied', 'on') }}"

automation:
  - id: bedroom_curtains_close_at_sundown
    alias: bedroom_curtains_close_at_sundown
    trigger:
      - platform: state
        entity_id: sun.sun
        to: below_horizon
    action:
      - service: cover.close_cover
        entity_id: cover.sovevaerelse_gardin

  - id: bedroom_balcony_door_open_reminder
    alias: bedroom_balcony_door_open_reminder
    trigger:
      - platform: state
        entity_id: sensor.bedroom_activity_state
        to: "off"
        for:
          minutes: 15
    condition:
      - alias: "Balcony door open"
        condition: state
        entity_id: binary_sensor.sovevaerelse_altandor
        state: "on"
      - alias: "Outside temp below 18"
        condition: numeric_state
        entity_id: sensor.altan_temperatur
        below: 18
    action:
      - service: script.notify_everywhere
        data:
          message: Soveværelse altandør står åben!
  - alias: bedroom_door_activity_on
    initial_state: true
    trigger:
      - platform: state
        entity_id: binary_sensor.sovevaerelse_dor
        to: "on"
    action:
      - service: input_boolean.turn_on
        data:
          entity_id: input_boolean.bedroom_door_activity

  - alias: bedroom_door_activity_off
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.bedroom_door_activity
        to: "on"
        for:
          seconds: 5
    action:
      - service: input_boolean.turn_off
        data:
          entity_id: input_boolean.bedroom_door_activity
