input_boolean:
  living_room_door_activity:
    initial: off
    name: Stue Dør Aktivitet
  bar_open:
    name: Bar Åben

binary_sensor:
  - platform: template
    sensors:
      living_room_door_activity:
        friendly_name: Stue Dør Aktivitet
        device_class: motion
        value_template: "{{ is_state('input_boolean.living_room_door_activity', 'on') }}"
      living_room_occupied:
        friendly_name: Stue Optaget
        device_class: occupancy
        value_template: "{{ is_state('input_boolean.living_room_occupied', 'on') }}"

automation:
  - alias: bar_switch_on
    initial_state: true
    trigger:
      - platform: event
        event_type: deconz_event
        event_data:
          id: bar_fjernbetjening
          event: 1002
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.bar_open

  - alias: bar_switch_off
    initial_state: true
    trigger:
      - platform: event
        event_type: deconz_event
        event_data:
          id: bar_fjernbetjening
          event: 2002
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.bar_open

  - alias: Barskab åbnet
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.bar_open
        to: "on"
    action:
      - service: scene.create
        data_template:
          scene_id: barskab_aabnet_restore
          snapshot_entities:
            - light.barskab_under
            - light.barskab_over
            - light.bar_spots
            - light.bar_uplight
            - light.bar_hylde_spots
            - light.bar
            - light.barbord
      - service: light.turn_on
        data:
          brightness: 255
          entity_id:
            - light.barskab_under
            - light.barskab_over
            - light.bar_spots
            - light.bar_uplight
            - light.bar_hylde_spots
            - light.bar
            - light.barbord
            - light.bar_skuffer

  - alias: Barskab lukket
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.bar_open
        to: "off"
    action:
      - service: scene.turn_on
        data:
          entity_id: scene.barskab_aabnet_restore
      - service: light.turn_off
        target:
          entity_id:
            - light.bar_skuffer

  # - alias: living_room_door_activity_on
  #   initial_state: true
  #   trigger:
  #     - platform: state
  #       entity_id: binary_sensor.stue_dor
  #       to: "on"
  #   action:
  #     - service: input_boolean.turn_on
  #       data:
  #         entity_id: input_boolean.living_room_door_activity

  # - alias: living_room_door_activity_off
  #   initial_state: true
  #   trigger:
  #     - platform: state
  #       entity_id: input_boolean.living_room_door_activity
  #       to: "on"
  #       for:
  #         seconds: 5
  #   action:
  #     - service: input_boolean.turn_off
  #       data:
  #         entity_id: input_boolean.living_room_door_activity
