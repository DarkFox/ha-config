input_boolean:
  living_room_door_activity:
    initial: off
    name: Stue Dør Aktivitet
  bar_open:
    name: Bar Åben

binary_sensor:
  - platform: template
    sensors:
      living_room_door_activity:
        friendly_name: Stue Dør Aktivitet
        device_class: motion
        value_template: "{{ is_state('input_boolean.living_room_door_activity', 'on') }}"
      living_room_occupied:
        friendly_name: Stue Optaget
        device_class: occupancy
        value_template: "{{ is_state('input_boolean.living_room_occupied', 'on') }}"

automation:
  - alias: bar_switch_on
    initial_state: true
    trigger:
      - platform: event
        event_type: deconz_event
        event_data:
          id: bar_fjernbetjening
          event: 1002
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.bar_open

  - alias: bar_switch_off
    initial_state: true
    trigger:
      - platform: event
        event_type: deconz_event
        event_data:
          id: bar_fjernbetjening
          event: 2002
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.bar_open

  - alias: Bar åbnet
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.bar_open
        to: "on"
    action:
      - event: refresh_light_profile
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.ismaskine

  - alias: Bar lukket
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.bar_open
        to: "off"
    action:
      - event: refresh_light_profile
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.ismaskine

  - id: bar_close_timeout
    alias: "Bar luk ved idle"
    trigger:
      - platform: state
        entity_id: binary_sensor.living_room_activity
        to: "off"
        for:
          hours: 4
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.bar_open

  - id: living_room_balcony_door_open_reminder
    alias: living_room_balcony_door_open_reminder
    trigger:
      - platform: state
        entity_id: sensor.living_room_activity_state
        to: "off"
        for:
          minutes: 15
    condition:
      - alias: "Balcony door open"
        condition: state
        entity_id: binary_sensor.stue_altandor
        state: "on"
      - alias: "Outside temp below 18"
        condition: numeric_state
        entity_id: sensor.altan_temperatur
        below: 18
    action:
      - service: script.notify_everywhere
        data:
          message: Stue altandør står åben!
