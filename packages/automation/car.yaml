automation:
  - alias: notify_car_charging
    id: notify_car_charging
    initial_state: true
    trigger:
      - platform: state
        entity_id: sensor.vw_connect_charging_state
        to: "charging"
    action:
      - service: notify.telegram_darkfox
        data:
          message: >
            Opladning startet. Bilen lader op til {{ states('sensor.vw_connect_target_soc_pct') }}%.
            FÃ¦rdig ca. {{ states('sensor.vw_connect_charging_complete_at') }}

  - alias: notify_15_minutes_till_car_charged
    id: notify_15_minutes_till_car_charged
    initial_state: true
    trigger:
      - platform: numeric_state
        entity_id: sensor.vw_connect_remaining_charging_time_to_complete_min
        below: 16
        for:
          minutes: 2
    condition:
      - condition: state
        entity_id: sensor.vw_connect_charging_state
        state: "charging"
    action:
      - service: notify.telegram_darkfox
        data:
          message: "Bilen er ladt op til {{ states('sensor.vw_connect_target_soc_pct') }}% om {{ states('sensor.vw_connect_remaining_charging_time_to_complete_min') }} minutter."

  - alias: notify_car_charged
    id: notify_car_charged
    initial_state: true
    trigger:
      - platform: state
        entity_id: sensor.vw_connect_charging_state
        from: "charging"
    action:
      - service: notify.telegram_darkfox
        data:
          message: "Oplading afsluttet. Bilen er ladt op til {{ states('sensor.vw_connect_current_soc_pct') }}%."

  - alias: notify_car_heating
    id: notify_car_heating
    trigger:
      - platform: state
        entity_id: binary_sensor.id_3_climatising
        to: "on"
    action:
      - service: notify.telegram_darkfox
        data:
          message: "Klimatiserer bilen. {{ states('sensor.vw_connect_remaining_climatisation_time_min') }} minutter tilbage."

  - alias: notify_charger_available_rsr
    id: notify_charger_available_rsr
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.rsr_spirii_lader_1_status
          - binary_sensor.rsr_spirii_lader_2_status
          - binary_sensor.rsr_spirii_lader_3_status
          - binary_sensor.rsr_spirii_lader_4_status
        to: "off"
    condition:
      - alias: "Car not plugged in"
        condition: state
        entity_id: binary_sensor.vw_connect_plug_connected
        state: "off"
      - alias: "Car needs charging"
        condition: numeric_state
        entity_id: sensor.id_3_battery
        below: 40
      - alias: "Is at RSR"
        condition: state
        entity_id: device_tracker.darkphone
        state: "RSR"
    action:
      - service: notify.telegram_darkfox
        data:
          message: "En ladeplads er lige blevet ledig."
