# entities used:
# Office: light.office_desk_spots
# Living Room: light.stue_spot_3
# Kitchen: light.kokken_loftlampe
# Bathroom: light.badevaerelse_lampe

input_boolean:
  vacation_mode:
    name: Ferie Tilstand
    icon: mdi:airplane-takeoff
  vacation_mode_lights_active:
    name: Vacation Mode Lights Active

binary_sensor:
  - platform: random
    name: vacation_mode_random_boolean

sensor:
  - platform: random
    name: vacation_mode_random_minutes
    maximum: 55

automation:
  - alias: Vacation Mode Off
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.vacation_mode
        to: "off"
    action:
      - service: input_boolean.turn_off
        data:
          entity_id: input_boolean.vacation_mode_lights_active
      - delay:
          seconds: 2
      - event: refresh_light_profile

  - alias: Vacation Lights On
    initial_state: true
    trigger:
      platform: time_pattern
      minutes: /5
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.vacation_mode
          state: "on"
        - condition: or
          conditions:
            - condition: time
              after: "17:00:00"
              before: "23:00:00"
              weekday:
                - mon
                - tue
                - wed
                - thu
                - fri
            - condition: time
              after: "10:00:00"
              before: "23:00:00"
              weekday:
                - sat
                - sun
        - condition: or
          conditions:
            - condition: template
              value_template: "{{ states.sun.sun.attributes.elevation < 4 }}"
            - condition: numeric_state
              entity_id: sensor.kitchen_luminance
              below: 10
    action:
      - service: input_boolean.turn_on
        data:
          entity_id: input_boolean.vacation_mode_lights_active

  - alias: Vacation Lights Off
    initial_state: true
    trigger:
      - platform: time
        at: "23:00:00"
    condition:
      condition: state
      entity_id: input_boolean.vacation_mode_lights_active
      state: "on"
    action:
      - service: input_boolean.turn_off
        data:
          entity_id: input_boolean.vacation_mode_lights_active

  - alias: Vacation Office on
    initial_state: true
    trigger:
      platform: state
      entity_id: input_boolean.vacation_mode_lights_active
      to: "on"
    action:
      - condition: state
        entity_id: binary_sensor.vacation_mode_random_boolean
        state: "on"
      - delay:
          hours: 1
          minutes: "{{ states('sensor.vacation_mode_random_minutes') }}"
      - service: light.turn_on
        data:
          entity_id: light.office_desk_spots
          brightness: 200

  - alias: Vacation Living Room on
    initial_state: true
    trigger:
      platform: state
      entity_id: input_boolean.vacation_mode_lights_active
      to: "on"
    action:
      - delay:
          minutes: "{{ states('sensor.vacation_mode_random_minutes') }}"
      - service: light.turn_on
        data:
          entity_id: light.stue_spot_3
          brightness: 200
          color_temp: 300

  - alias: Vacation Kitchen on
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.vacation_mode_lights_active
        to: "on"
      - platform: event
        event_type: vacation_kitchen_loop
    action:
      - delay:
          minutes: "{{ states('sensor.vacation_mode_random_minutes') }}"
      - service: light.turn_on
        data:
          entity_id: light.kokken_loftlampe
          color_temp: 300
          brightness: 200
      - delay:
          minutes: "{{ (states('sensor.vacation_mode_random_minutes')) | int }}"
      - service: light.turn_off
        data:
          entity_id: light.kokken_loftlampe
      - delay:
          hours: 2
      - event: vacation_kitchen_loop

  - alias: Vacation Bathroom on
    initial_state: true
    trigger:
      - platform: state
        entity_id: input_boolean.vacation_mode_lights_active
        to: "on"
      - platform: event
        event_type: vacation_bathroom_loop
    condition:
      condition: state
      entity_id: input_boolean.vacation_mode_lights_active
      state: "on"
    action:
      - delay:
          minutes: "{{ states('sensor.vacation_mode_random_minutes') }}"
      - service: light.turn_on
        data:
          entity_id: light.badevaerelse_lampe
          brightness: 200
          color_temp: 300
      - delay:
          minutes: "{{ (states('sensor.vacation_mode_random_minutes')/2) | int }}"
      - service: light.turn_off
        data:
          entity_id: light.badevaerelse_lampe
      - delay:
          hours: 2
      - event: vacation_bathroom_loop

  - alias: Vacation Office Off
    initial_state: true
    trigger:
      platform: state
      entity_id: input_boolean.vacation_mode_lights_active
      to: "off"
    action:
      - delay:
          minutes: "{% if is_state('input_boolean.vacation_mode_lights_active', 'on') %}{{ states('sensor.vacation_mode_random_minutes') }}{% else %}0{% endif %}"
      - service: light.turn_off
        data:
          entity_id: light.office_desk_spots

  - alias: Vacation Living Room Off
    initial_state: true
    trigger:
      platform: state
      entity_id: input_boolean.vacation_mode_lights_active
      to: "off"
    action:
      - delay:
          minutes: "{% if is_state('input_boolean.vacation_mode_lights_active', 'on') %}{{ states('sensor.vacation_mode_random_minutes') }}{% else %}0{% endif %}"
      - service: light.turn_off
        data:
          entity_id: light.stue_spot_3

  - alias: Vacation Kitchen Off
    initial_state: true
    trigger:
      platform: state
      entity_id: input_boolean.vacation_mode_lights_active
      to: "off"
    action:
      - delay:
          minutes: "{% if is_state('input_boolean.vacation_mode_lights_active', 'on') %}{{ states('sensor.vacation_mode_random_minutes') }}{% else %}0{% endif %}"
      - service: light.turn_off
        data:
          entity_id: light.kokken_loftlampe

  - alias: Vacation Bathroom Off
    initial_state: true
    trigger:
      platform: state
      entity_id: input_boolean.vacation_mode_lights_active
      to: "off"
    action:
      - delay:
          minutes: "{% if is_state('input_boolean.vacation_mode_lights_active', 'on') %}{{ states('sensor.vacation_mode_random_minutes') }}{% else %}0{% endif %}"
      - service: light.turn_off
        data:
          entity_id: light.badevaerelse_lampe
