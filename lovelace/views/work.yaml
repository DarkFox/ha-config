title: Arbejde
path: work
icon: mdi:briefcase
type: custom:grid-layout
layout:
  grid-template-columns: 33.3% 33.3% 33.3%
  grid-template-rows: auto
  grid-template-areas: |
    "header header header"
    "left middle right"
  mediaquery:
    "(max-width: 800px)":
      grid-template-columns: 100%
      grid-template-areas: |
        "header"
        "left"
        "middle"
        "right"
    "(max-width: 1200px)":
      grid-template-columns: 50% 50%
      grid-template-areas: |
        "header header"
        "left middle"
        "right right"
cards:
  - type: vertical-stack
    cards:
      - !include ../cards/compact_clock.yaml

      - type: conditional
        conditions:
          - entity: sensor.current_work_call
            state_not: ""
        card:
          type: custom:button-card
          entity: sensor.current_work_call
          icon: mdi:card-account-phone-outline
          show_icon: true
          show_state: true
          show_label: true
          show_name: true
          layout: icon_state_name2nd
          name: |
            [[[
              var caller_info = states['sensor.current_work_call'].attributes.caller_info;
              if (caller_info.title == null && caller_info.organization == null)
                return '';
              else if (caller_info.title == null)
                return caller_info.organization;
              else if (caller_info.organization == null)
                return caller_info.title;
              else
                return states['sensor.current_work_call'].attributes.caller_info.title + ' - ' + states['sensor.current_work_call'].attributes.caller_info.organization
            ]]]
          label: "[[[ return states['sensor.current_work_call'].attributes.caller_info.name ]]]"
          styles:
            label:
              - font-size: 1.5em
              - font-weight: bold
              - color: var(--primary-text-color)

      - type: grid
        columns: 2
        square: false
        cards:
          - type: custom:button-card
            entity: script.leave_work_early
            layout: icon_name
            tap_action:
              action: call-service
              service: script.leave_work_early
          - type: custom:button-card
            entity: switch.rook_pc
            name: "Hjemme PC"
            icon: mdi:desktop-tower
            layout: icon_name
            tap_action:
              action: call-service
              service: script.start_pc_for_remote

  - type: vertical-stack
    cards:
      - type: custom:button-card
        entity: sensor.next_work_event
        icon: mdi:calendar-clock
        show_icon: true
        show_state: true
        show_label: true
        show_name: true
        layout: icon_name_state2nd
        # Label = attributes.start_time
        name: "[[[ return states['sensor.next_work_event'].attributes.start_time ]]]"
        label: |
          [[[
            let event = states['sensor.2nd_next_work_event'];
            if (!['Ingen', 'unavailable', 'unknown'].includes(event.state))
              return event.attributes.start_time + '<br />' + event.state;
            else
              return '';
          ]]]
        tap_action:
          action: call-service
          service: homeassistant.update_entity
          service_data:
            entity_id:
              - calendar.vagtplan
              - calendar.arbejdskalender
        styles:
          name:
            - font-size: 1.5em
            - font-weight: bold
            - color: var(--primary-text-color)
          label:
            - margin-top: 0.2em
            - font-size: 0.8em
            - font-weight: normal
            - color: var(--primary-text-color)
            - border-top: 1px solid var(--primary-text-color)

      - !include ../cards/gdq/compact_overview.yaml

      - !include ../cards/calendar_work.yaml

      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing
            state: "on"
        card: !include ../cards/3d_printer/preview.yaml

  - type: vertical-stack
    cards:
      - !include ../cards/transport/car.yaml

      - !include ../cards/transport/upcoming_travel.yaml

      - !include ../cards/weather/weather_forecast.yaml
