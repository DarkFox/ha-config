title: Arbejde
path: work
type: panel
icon: mdi:briefcase
badges: []
cards:
  - type: vertical-stack
    cards:
      - !include ../cards/time_to_leave_countdown.yaml

      - type: custom:layout-card
        layout_type: custom:horizontal-layout
        layout:
          max_cols: 3
        cards:
          - type: vertical-stack
            cards:
              - type: custom:button-card
                entity: sensor.puzzel_state
                label: "[[[ return states['sensor.puzzel_state'].state == 'Logget af' ? '' : states['sensor.puzzel_ko'].state ]]]"
                icon: mdi:phone
                layout: icon_state_name2nd
                show_name: false
                show_state: true
                show_label: true
                state:
                  - value: "Ledig"
                    color: var(--label-badge-green)
                  - value: "Logget af"
                    color: var(--label-badge-red)
                    icon: mdi:phone-off
                  - value: "Andet"
                    color: var(--label-badge-yellow)
                    icon: mdi:phone-paused
                  - value: "I møde"
                    color: var(--label-badge-yellow)
                    icon: mdi:phone-paused

              - type: custom:auto-entities
                card:
                  type: entities
                  title: Puzzel
                filter:
                  template: |
                    {% set profiles = (
                      state_attr('sensor.puzzel_status', 'result').profiles
                      | list
                    ) %}
                    {% set ns = namespace(ret=[
                      {
                        "entity": "script.puzzel_log_off",
                        "icon": "mdi:logout",
                        "name": "Log af",
                        "action_name": "Log af"
                      },
                      {
                        "type": "section",
                        "label": "Kø"
                      }
                    ]) %}
                    {% for profile in profiles %}
                      {% set ns.ret = ns.ret + [
                        {
                          "type": "button",
                          "name": profile.name,
                          "icon": "mdi:login",
                          "action_name": "Log ind",
                          "tap_action": {
                              "action": "call-service",
                              "service": "script.puzzel_log_on",
                              "data": {
                                "queue_id": profile.id
                              }
                          }
                        }
                      ] %}
                    {% endfor %}
                    {% set ns.ret = ns.ret + [
                      {
                        "type": "section",
                        "label": "Pause"
                      }
                    ] %}
                    {% set pauseTypes = (
                      state_attr('sensor.puzzel_user', 'result').pauseTypes
                      | list
                    ) %}
                    {% for pauseType in pauseTypes %}
                      {% set ns.ret = ns.ret + [
                        {
                          "type": "button",
                          "name": pauseType.description,
                          "icon": "mdi:logout-variant",
                          "action_name": "Pause",
                          "tap_action": {
                              "action": "call-service",
                              "service": "script.puzzel_pause_on",
                              "data": {
                                "pause_type": pauseType.description
                              }
                          }
                        }
                      ] %}
                    {% endfor %}
                    {% set ns.ret = ns.ret + [
                      {
                        "entity": "script.puzzel_pause_off",
                        "icon": "mdi:logout",
                        "name": "Tilbage",
                        "action_name": "Tilbage"
                      }
                    ] %}
                    {{ ns.ret }}

          - type: vertical-stack
            cards:
              - !include ../cards/compact_clock.yaml

              - type: custom:button-card
                entity: sensor.next_work_event
                icon: mdi:calendar-clock
                show_icon: true
                show_state: true
                show_label: true
                show_name: false
                layout: icon_state_name2nd
                # Label = attributes.start_time
                label: "[[[ return states['sensor.next_work_event'].attributes.start_time ]]]"
                styles:
                  label:
                    - font-size: 1.5em
                    - font-weight: bold
                    - color: var(--primary-text-color)

              - !include ../cards/calendar_work.yaml

          - type: vertical-stack
            cards:
              - !include ../cards/transport/car.yaml
              - type: entities
                entities:
                  - entity: sensor.parking_limit
                    name: Parkering udløber

              - !include ../cards/weather/weather_forecast.yaml
