substitutions:
  devicename: ha_server
  upper_devicename: HA Server
  restore_mode: ALWAYS_ON

packages:
  base: !include packages/base.yaml
  gosund: !include packages/gosund.yaml

wifi:
  reboot_timeout: 30min

# Enable Home Assistant API
api:
  reboot_timeout: 30min
  on_client_disconnected:
    - if:
        condition:
          for:
            time: 15min
            condition:
              not:
                api.connected:
        then:
          - if:
              condition:
                switch.is_on: disable_watchdog
              then:
                - logger.log: "Client disconnected for 15 minutes, watchdog disabled"
              else:
                - logger.log: "Client disconnected for 15 minutes, doing a hard restart"
                - switch.turn_off: relay
                - delay: 5s
                - switch.turn_on: relay

binary_sensor:
  - platform: status
    name: "HA Server Status"

switch:
  - platform: template
    name: "Disable Watchdog"
    id: disable_watchdog
    optimistic: true
