esphome:
  name: dortelefon
  platform: ESP8266
  board: nodemcu

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_pass
  use_address: 192.168.42.239

# Enable logging
# logger:

# Enable Home Assistant API
api:
  password: !secret api_pass

ota:
  password: !secret ota_pass

# web_server:
#   port: 80
status_led:
  pin: GPIO2

sensor:
  - platform: adc
    pin: A0
    id: dortelefon_sound_raw
    internal: true
    update_interval:
      milliseconds: 10

binary_sensor:
  - platform: template
    id: dortelefon_sound
    on_click:
      - min_length: 10ms
        max_length: 30ms
        then:
          - binary_sensor.template.publish:
              id: dortelefon_open
              state: ON
      - min_length: 50ms
        then:
          - binary_sensor.template.publish:
              id: dortelefon_ringing
              state: ON
    lambda: |-
      if (id(dortelefon_sound_raw).state > 0.9) {
        // Ringing
        return true;
      } else {
        // Not ringing
        return false;
      }

  - platform: template
    name: "Dørtelefon Ringer"
    id: dortelefon_ringing
    device_class: sound
    on_press:
      then:
        - delay: 30s
        - binary_sensor.template.publish:
            id: dortelefon_ringing
            state: OFF

  - platform: template
    name: "Dørtelefon Åben"
    id: dortelefon_open
    device_class: sound
    on_press:
      then:
        - delay: 2s
        - binary_sensor.template.publish:
            id: dortelefon_open
            state: OFF
